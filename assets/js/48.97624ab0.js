(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{275:function(t,e,a){"use strict";a.r(e);var s=a(0),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("p",[t._v("Storefront API provides you with unified tooling for managing embedded Elastic Schema. This tool lets you create new indexes or apply modified index mappings to exisiting ones. ElasticSchema is provided on the "),a("router-link",{attrs:{to:"./../modules/introduction.html"}},[t._v("modules")]),t._v(" level.")],1),t._v(" "),t._m(1),t._v(" "),a("p",[t._v("After more extensive data operations, like custom imports using "),a("a",{attrs:{href:"https://github.com/DivanteLtd/mage2vuestorefront",target:"_blank",rel:"noopener noreferrer"}},[t._v("mage2vuestorefront"),a("OutboundLink")],1),t._v(" or "),a("a",{attrs:{href:"https://github.com/DivanteLtd/magento1-vsbridge",target:"_blank",rel:"noopener noreferrer"}},[t._v("magento1-vsbridge"),a("OutboundLink")],1),t._v(", there is a need to reindex the ElasticSearch and set up the proper metadata for fields.")]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),a("p",[t._v("This command will:")]),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),a("p",[t._v("If you want to create a new, empty index, please run:")]),t._v(" "),t._m(12),a("p",[t._v("This tool will drop your current index and create a new, empty one with all the metafields set.")]),t._v(" "),t._m(13),t._v(" "),t._m(14),t._m(15),t._v(" "),a("p",[t._v("If you want to extend the Elasticsearch data structures or map some particular field types, for example, after getting kind of this error:")]),t._v(" "),t._m(16),a("p",[t._v("Please change the ES schema by modifying the schema provided by a particular "),a("router-link",{attrs:{to:"./../modules/introduction.html"}},[t._v("module")]),t._v(".")],1),t._v(" "),a("p",[t._v("The format is compliant with "),a("a",{attrs:{href:"https://www.elastic.co/blog/found-elasticsearch-mapping-introduction",target:"_blank",rel:"noopener noreferrer"}},[t._v("ES DSL for schema modifications"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("After the changes, run the following indexing command:")]),t._v(" "),t._m(17)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"database-tool"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#database-tool"}},[this._v("#")]),this._v(" Database tool")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"the-need-for-a-database-tool"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#the-need-for-a-database-tool"}},[this._v("#")]),this._v(" The need for a database tool")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The main reason youâ€™ll know you must reindex the database is the following error you get from the "),e("code",[this._v("storefront-api")]),this._v(" console:")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("Error"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"root_cause"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"illegal_argument_exception"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"reason"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Fielddata is disabled on text fields by default. Set fielddata=true on [created_at] in order to load fielddata in memory by uninverting the inverted index. Note that this can however use significant memory. Alternatively use a keyword field instead."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"search_phase_execution_exception"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"reason"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all shards failed"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"phase"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"query"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"grouped"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"failed_shards"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"shard"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"index"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vue_storefront_catalog_1521776807"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"node"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xIOeZW2lTwaprGXh6YLyCA"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"reason"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"illegal_argument_exception"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"reason"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Fielddata is disabled on text fields by default. Set fielddata=true on [created_at] in order to load fielddata in memory by uninverting the inverted index. Note that this can however use significant memory. Alternatively use a keyword field instead."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("In this case, there is a db tool inside your local "),e("code",[this._v("storefront-api")]),this._v(" installation to the rescue.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"re-indexing-an-existing-database"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#re-indexing-an-existing-database"}},[this._v("#")]),this._v(" Re-indexing an existing database")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Please go to the "),e("code",[this._v("storefront-api")]),this._v(" directory and run:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[this._v("exec")]),this._v(" -it sfa_app_1 "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("yarn")]),this._v(" db7 rebuild\n")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",[a("li",[t._v("Reindex your currently set (in the "),a("code",[t._v("config/local.json")]),t._v(" config file) Elasticsearch index to a temporary one,")]),t._v(" "),a("li",[t._v("Put the right Elasticsearch mappings on top of the temporary index,")]),t._v(" "),a("li",[t._v("Drop the original index,")]),t._v(" "),a("li",[t._v("Create an alias with the original name to the temporary one so you can use the original name without any reference changes.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("You can specify an index name different to the one set in "),e("code",[this._v("config/local.json")]),this._v(" by running:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[this._v("exec")]),this._v(" -it sfa_app_1 "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("yarn")]),this._v(" db7 rebuild -- --indexName"),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("custom_index_name\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"creating-the-a-new-index"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-the-a-new-index"}},[this._v("#")]),this._v(" Creating the a new index")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[this._v("exec")]),this._v(" -it sfa_app_1 "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("yarn")]),this._v(" db7 new\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("You can specify an index name different to the one set in "),e("code",[this._v("config/local.json")]),this._v(" by running:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[this._v("exec")]),this._v(" -it sfa_app_1 "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("yarn")]),this._v(" db7 rebuild -- --indexName"),e("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("custom_index_name\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"changing-the-index-structure-adding-new-fields-changing-the-types"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#changing-the-index-structure-adding-new-fields-changing-the-types"}},[this._v("#")]),this._v(" Changing the index structure / adding new fields / changing the types")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('[{"type":"illegal_argument_exception","reason":"Fielddata is disabled on text fields by default. Set fielddata=true on [created_at] in order to load fielddata in memory by uninverting the inverted index. Note that this can however use significant memory. Alternatively use a keyword field instead."}]\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[this._v("exec")]),this._v(" -it sfa_app_1 "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("yarn")]),this._v(" db7 rebuild\n")])])])}],!1,null,null,null);e.default=n.exports}}]);